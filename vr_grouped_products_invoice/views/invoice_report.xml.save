<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>

        <template id="report_invoice_document_bol_original_salur"
                  inherit_id="l10n_bo_invoice.report_invoice_document_bol_original">

            <xpath expr="//div[@class='page']" position="replace">
                <div class="page">

                    <t t-set="max_page" t-value="32"/>
                    <t t-set="max_page_final" t-value="342/>
                    <t t-set="page_aux" t-value="0"/>
                    <t t-set="total_pages" t-value="ceil(len(o.invoice_line_ids)/max_page)"/>
                    <t t-foreach="range(total_pages)" t-as="page">

                        <!-- <t t-if="total_pages == (page+1)">
                            <t t-set="max_page" t-value="max_page_final"></t>
                        </t> -->
                        <!-- ADD PAGE -->
                        <t t-if="page &gt; page_aux">
                            <t t-set="page_aux" t-value="page"/>
                            <p style="page-break-after:always;"></p>
                        </t>
                        <!-- END -->

                        <div style="height:35px; width:100%;"></div>
                        <table style="border-collapse: collapse; width: 100%; font-size:12px;">
                            <col width="35%"/>
                            <col width="35%"/>
                            <col width="30%"/>
                            <tr>
                                <td></td>
                                <td style="text-align:center;">
                                    <span t-esc="(page+1)"/>
                                    de
                                    <span t-esc="total_pages"/>
                                </td>
                                <td>
                                    <div style="padding:20px;">
                                        <table style="width:100%; font-size:12px;">
                                            <col width="55%"/>
                                            <col width="2%"/>
                                            <col width="43%"/>
                                            <tr>
                                                <th>NIT</th>
                                                <th>:</th>
                                                <td>
                                                    <span t-field="o.company_id.nit_ci"></span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>No. FACTURA</th>
                                                <th>:</th>
                                                <td>
                                                    <span t-esc="'%.0f'%o.n_factura"></span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>No. AUTORIZACIÓN</th>
                                                <th>:</th>
                                                <td>
                                                    <span t-field="o.n_autorizacion"></span>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" style="height:45px;"></td>
                            </tr>
                            <tr>
                                <td class="text-center">
                                    <t t-if="o.warehouse_id.casa_matriz">
                                    </t>
                                    <t t-if="not o.warehouse_id.casa_matriz">
                                        <ul style="list-style: none; line-height:100%; font-size:12px;
                                                margin-top:-12px;margin-left:-65px">
                                            <li>
                                                <strong>
                                                    <span t-field="o.warehouse_id.name"/>
                                                </strong>
                                            </li>
                                            <li>
                                                <span t-field="o.warehouse_id.partner_id.street"/>
                                            </li>
                                            <li>
                                                Teléfono:
                                                <span t-field="o.warehouse_id.partner_id.phone"/>
                                            </li>
                                            <li>
                                                <span t-field="o.warehouse_id.partner_id.city"/>
                                            </li>
                                        </ul>
                                    </t>
                                </td>
                                <td></td>
                                <td style="text-align:center;">
                                    <span t-field="o.dosificacion.actividad.name"/>
                                </td>
                            </tr>
                        </table>
                        <table style="width:100%; margin-top:150px; font-size:12px;"
                               cellpadding="0" cellspacing="0">
                            <col width="10%"/>
                            <col width="40%"/>
                            <col width="5%"/>
                            <col width="15%"/>
                            <col width="15%"/>
                            <col width="15%"/>
                            <tr>
                                <td colspan="6" style="padding:10px;">
                                    <table style="width:100%">
                                        <col width="15%"/>
                                        <col width="35%"/>
                                        <col width="15%"/>
                                        <col width="35%"/>
                                        <tr>
                                            <th style="text-align:left;">Fecha:</th>
                                            <td style="text-align:left;">
                                                <t t-if="o.warehouse_id.casa_matriz">
                                                    <span t-field="o.company_id.partner_id.city"/>,
                                                </t>
                                                <t t-if="not o.warehouse_id.casa_matriz">
                                                    <span t-field="o.warehouse_id.partner_id.city"/>,
                                                </t>
                                                <span t-field="o.invoice_date" t-options="{'format': 'EEEE, d '}"/>
                                                de
                                                <span t-field="o.invoice_date" t-options="{'format': 'MMMM '}"/>
                                                del
                                                <span t-field="o.invoice_date" t-options="{'format': 'YYYY'}"/>
                                            </td>
                                            <th style="text-align:left;">NIT/CI:</th>
                                            <td style="text-align:left;">
                                                <span t-field="o.nit_ci"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="text-align:left;">Nombre:</th>
                                            <td style="text-align:left;">
                                                <span t-field="o.razon_social"/>
                                            </td>
                                            <th style="text-align:left;">No Orden de Venta:</th>
                                            <td style="text-align:left;">
                                                <span t-field="o.name"/>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr style="border-bottom:1px dashed #222;">
                                <th style="height:45px; vertical-align: middle; font-size:14px;">Articulo</th>
                                <th style="height:45px; vertical-align: middle; font-size:14px;">Descripción</th>
                                <th style="height:45px; vertical-align: middle; font-size:14px;">U/M</th>
                                <th style="text-align:right; height:45px; vertical-align: middle; font-size:14px;">
                                    Cantidad
                                </th>
                                <th style="text-align:right; height:45px; vertical-align: middle; font-size:14px;">
                                    Precio
                                </th>
                                <th style="text-align:right; height:45px; vertical-align: middle; font-size:14px;">
                                    Total
                                </th>
                            </tr>
                            <tr>
                                <td colspan="6" style="line-height: 18px;">&amp;nbsp;</td>
                            </tr>

                            <t t-set="lines"
                               t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                            <t t-set="lines" t-value="lines[((max_page+1)*page):((max_page+1)*(page+1))]"/>
                            <t t-foreach="lines" t-as="line">
                                <t t-if="line.grouped_line == false">
                                    <tr>
                                        <td>
                                            <span t-field="line.product_id.default_code"/>
                                        </td>
                                        <td>
                                            <span t-field="line.name"/>
                                        </td>
                                        <td>PZA</td>
                                        <td style="text-align:right;">
                                            <span t-field="line.quantity"/>
                                            <span t-field="line.uom_id" groups="product.group_uom"/>
                                        </td>
                                        <td style="text-align:right;">
                                            <t t-esc="'{0:,.2f}'.format(line.price_unit)"/>
                                        </td>
                                        <td style="text-align:right;">
                                            <t t-set="t_total" t-value="line.quantity*line.price_unit"/>
                                            <t t-esc="'{0:,.2f}'.format(t_total)"/>
                                        </td>
                                    </tr>
                                </t>
                            </t>
                            <!-- GROUPED -->
                            <t t-foreach="o.grouped_products_ids" t-as="line">
                                <tr style="line-height: 18px;">
                                    <td class="text-left">
                                        <span t-field="line.code"/>
                                    </td>
                                    <td>
                                        <span t-field="line.description"/>
                                    </td>
                                    <td>UND</td>
                                    <td style="text-align:right;">
                                        <t t-esc="'{0:,.2f}'.format(1)"/>
                                    </td>
                                    <td style="text-align:right;">
                                        <t t-esc="'{0:,.2f}'.format(line.total_amount)"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-set="t_total" t-value="line.total_amount"/>
                                        <t t-esc="'{0:,.2f}'.format(t_total)"/>
                                    </td>
                                </tr>
                            </t>
                            <!-- END GROUPED -->
                            <tr t-foreach="range(max(max_page-len(lines),0))" t-as="l"
                                style="line-height: 18px;">
                                <td style="line-height: 18px;">&amp;nbsp;</td>
                                <td style="line-height: 18px;"></td>
                                <td style="line-height: 18px;"></td>
                                <td style="line-height: 18px;"></td>
                                <td style="line-height: 18px;"></td>
                                <td style="line-height: 18px;"></td>
                            </tr>
                            <tr>
                                <td class="text-left">
                                    <span t-field="o.narration"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="6" style="vertical-align:middle; height:20px;">
                                    <hr style="border:1px dashed #222;"/>
                                </td>
                            </tr>

                            <!-- TOTALES -->
                            <t t-if="total_pages == (page+1)">
                                <tr>
                                    <td colspan="4" rowspan="4">
                                        <t>
                                            <strong>Vendedor:</strong>
                                            <span t-esc="o.invoice_user_id.name"/>
                                        </t>
                                        <br/>
                                        <t>
                                            <strong>Son:</strong>
                                            <span t-esc="o.amount_text"/>
                                        </t>
                                        <br></br>
                                        <t t-if="o.amount_imp != o.amount_total">
                                            <strong>Importe base para Crédito Fiscal, Ley° 317 Bs.:</strong>
                                            <t t-esc="'{0:,.2f}'.format(o.amount_total-o.amount_exe - o.amount_ice_iehd)"/>
                                        </t>
                                        <br t-if="o.amount_imp != o.amount_total"></br>
                                    </td>
                                    <td style="height: 18px !important; font-weight:bold;">
                                        SUBTOTAL Bs.:
                                    </td>
                                    <td class="text-right" style="height: 18px !important;">
                                        <t t-esc="'{0:,.2f}'.format(o.amount_open)"/>
                                    </td>
                                </tr>
                                <tr style="line-height: 18px;">
                                    <td style="font-weight:bold;">
                                        DESCUENTO Bs.:
                                    </td>
                                    <td class="text-right">
                                        <t t-esc="'{0:,.2f}'.format(o.amount_des)"/>
                                    </td>
                                </tr>
                                <tr style="line-height: 18px;">
                                    <td style="font-weight:bold;">
                                        TOTAL Bs.:
                                    </td>
                                    <td class="text-right">
                                        <t t-esc="'{0:,.2f}'.format(o.amount_total)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="border-bottom:1px solid #222;"></td>
                                </tr>
                            </t>
                        </table>
                        <br></br>

                        <t t-if="total_pages == (page+1)">

                            <!-- CODIGO DE CONTROL - QR -->
                            <table style="width:100%; font-size:12px; height:170px;">
                                <col width="30%"/>
                                <col width="40%"/>
                                <col width="30%"/>
                                <tr>
                                    <td style="vertical-align:middle;">
                                        <t>
                                            <strong>Código de Control:</strong>
                                            <span t-field="o.codigo_control"/>
                                        </t>
                                        <br></br>
                                        <t>
                                            <strong>Fecha Límite de Emisión:</strong>
                                            <span t-field="o.date_end"/>
                                        </t>
                                    </td>
                                    <td></td>
                                    <td>
                                        <img t-if="o.qr_image" t-att-src="image_data_uri(o.qr_image)"
                                             class="float-right"
                                             alt="Logo"
                                             style="width: 150px; height: 150px; margin-right: 10px; display:inline"/>
                                    </td>
                                </tr>
                            </table>
                            <br></br>
                            <table style="width:100%; font-size:12px;">
                                <tr>
                                    <td style="text-align:center;">
                                        <strong style="font-size:14px; font-weight: bold;">
                                            "ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAÍS. EL USO ILÍCITO DE ÉSTA SERÁ
                                            SANCIONADOS DE ACUERDO A LEY"
                                        </strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align:center;">
                                        <span style="font-size:12px;" t-esc="o.dosificacion.leyenda.name"/>
                                    </td>
                                </tr>
                            </table>
                            <!--<p t-if="o.narration" name="comment">
                                <span t-field="o.narration"/>
                            </p>-->

                        </t>

                    </t>
                </div>
            </xpath>

        </template>

    </data>


</odoo>
